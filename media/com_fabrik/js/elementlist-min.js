/*! Fabrik */
FbElementList=my.Class(FbElement,{type:"text",constructor:function(a,b){FbElementList.Super.call(this,a,b),this.addSubClickEvents(),this._getSubElements(),this.options.allowadd===!0&&this.options.editable!==!1&&(this.watchAddToggle(),this.watchAdd())},_getSubElements:function(){var a=this.find();return this.subElements=0===a.length?[]:a.find("input[type="+this.type+"]"),this.subElements},addSubClickEvents:function(){this._getSubElements().each(function(){$(this).on("click",function(a){Fabrik.trigger("fabrik.element.click",[this,a])})})},addNewEvent:function(action,js){var r,delegate,uid,c,self=this;"load"===action?(this.loadEvents.push(js),this.runLoadEvent(js)):(c=this.form.form,delegate=action+":input[type="+this.type+"][name^="+this.options.fullName+"]","null"===typeOf(this.form.events[action])&&(this.form.events[action]={}),"function"==typeof js?uid=1e3*Math.random(100):(r=new RegExp("[^a-z|0-9]","gi"),uid=delegate+js.replace(r,"")),void 0===this.form.events[action][uid]&&(this.form.events[action][uid]=!0,c.on(action,"input[type="+this.type+"][name^="+this.options.fullName+"]",function(event,target){var elid=target.closest(".fabrikSubElementContainer").id,that=self.form.formElements[elid],subEls=that._getSubElements();subEls.contains(target)&&("function"!=typeof js?(js=js.replace(/this/g,"that"),eval(js)):js.delay(0))})))},checkEnter:function(a){"enter"===a.key&&(a.stopPropagation(),this.startAddNewOption())},startAddNewOption:function(){var a,b=this.getContainer(),c=b.find("input[name=addPicklistLabel]"),d=b.find("input[name=addPicklistValue]"),e=c.value;if(a=d?d.value:e,""===a||""===e)alert(Joomla.JText._("PLG_ELEMENT_CHECKBOX_ENTER_VALUE_LABEL"));else{var f=this.subElements.getLast().findClassUp("fabrikgrid_"+this.type).clone(),g=f.find("input");if(g.value=a,g.checked="checked","checkbox"===this.type){var h=g.name.replace(/^(.*)\[.*\](.*?)$/,"$1$2");g.name=h+"["+this.subElements.length+"]"}f.find("."+this.type+" span").text(e),f.inject(this.subElements.getLast().findClassUp("fabrikgrid_"+this.type),"after");var i=0;"radio"===this.type&&(i=this.subElements.length);var j=$("input[name="+g.name+"]");$("#"+this.form.form).trigger("change",{target:j[i]}),this._getSubElements(),d&&(d.value=""),c.value="",this.addNewOption(a,e),this.mySlider&&this.mySlider.toggle()}},watchAdd:function(){var a=this;if(this.options.allowadd===!0&&this.options.editable!==!1){var b=this.getContainer();b.find("input[name=addPicklistLabel], input[name=addPicklistValue]").on("keypress",function(b){a.checkEnter(b)}),b.find("input[type=button]").on("click",function(b){b.stopPropagation(),a.startAddNewOption()}),$(document).on("keypress",function(b){"esc"===b.key&&a.mySlider&&a.mySlider.slideOut()})}}});