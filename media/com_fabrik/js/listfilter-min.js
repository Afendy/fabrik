/*! Fabrik */
var FbListFilter=my.Class({options:{container:"",type:"list",id:"",advancedSearch:{controller:"list"}},constructor:function(a){var b,c=this;this.filters={},this.options=$.extend(this.options,a),this.advancedSearch=!1,this.container=document.id(this.options.container),this.filterContainer=this.container.find(".fabrikFilterContainer"),this.filtersInHeadings=this.container.find(".listfilter");var d=this.container.find(".toggleFilters");if(d.on("click",function(a){a.stopPropagation(),this.filterContainer.toggle(),this.filtersInHeadings.toggle()}.bind(this)),this.filterContainer.hide(),this.filtersInHeadings.toggle(),0!==this.container.length){this.getList();var e=this.container.find(".clearFilters");e.off(),e.on("click",function(a){var b;a.stopPropagation(),this.container.find(".fabrik_filter").each(function(a){(a.name.contains("[value]")||a.name.contains("fabrik_list_filter_all")||a.hasClass("autocomplete-trigger"))&&("SELECT"===$(this).prop("tagName")?this.selectedIndex=$(this).prop("multiple")?-1:0:"checkbox"===$(this).prop("type")?this.checked=!1:this.value="")}),b=this.getList().plugins,null!==b&&b.each(function(a){a.clearFilter()});var c="FORM"===this.container.prop("tagName")?this.container:this.container.find("form");$("<input />").attr({name:"resetfilters",value:1,type:"hidden"}).inject(c),"list"===this.options.type?this.list.submit("list.clearfilter"):this.container.find("form[name=filter]").submit()}.bind(this)),(b=this.container.find(".advanced-search-link"))&&b.on("click",function(a){a.stopPropagation();var b=a.target;"A"!==b.prop("tagName")&&(b=b.closest("a"));var d=b.href;d+="&listref="+c.options.ref,this.windowopts={id:"advanced-search-win"+c.options.ref,title:Joomla.JText._("COM_FABRIK_ADVANCED_SEARCH"),loadMethod:"xhr",evalScripts:!0,contentURL:d,width:710,height:340,y:c.options.popwiny,onContentLoaded:function(){var a=Fabrik.blocks["list_"+c.options.ref];0===a.length&&(a=Fabrik.blocks[c.options.container],c.options.advancedSearch.parentView=c.options.container),a.advancedSearch=new AdvancedSearch(c.options.advancedSearch),e.fitToContent(!1)}};var e=Fabrik.getWindow(c.windowopts)})}},getList:function(){return this.list=Fabrik.blocks[this.options.type+"_"+this.options.ref],0===this.list.length&&(this.list=Fabrik.blocks[this.options.container]),this.list},addFilter:function(a,b){this.filters.hasOwnProperty(a)===!1&&(this.filters[a]=[]),this.filters[a].push(b)},onSubmit:function(){this.filters.date&&jQuery.each(this.filters.date,function(a,b){b.onSubmit()})},onUpdateData:function(){this.filters.date&&jQuery.each(this.filters.date,function(a,b){b.onUpdateData()})},getFilterData:function(){var a={};return this.container.find(".fabrik_filter").each(function(){if($(this).prop("id").test(/value$/)){var b=$(this).prop("id").match(/(\S+)value$/)[1];a[b]="SELECT"===$(this).prop("tagName")&&-1!==this.selectedIndex?$("#"+this.options[this.selectedIndex]).text():$(this).val(),a[b+"_raw"]=$(this).val()}}),a},update:function(){$.each(this.filters,function(a,b){b.each(function(a){a.update()})})}});