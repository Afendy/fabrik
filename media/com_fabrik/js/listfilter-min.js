/*! Fabrik */
var FbListFilter=my.Class({options:{container:"",type:"list",id:"",advancedSearch:{controller:"list"}},constructor:function(a){var b;this.filters={},this.options=$.extend(this.options,a),this.advancedSearch=!1,this.container=document.id(this.options.container),this.filterContainer=this.container.find(".fabrikFilterContainer"),this.filtersInHeadings=this.container.find(".listfilter");var c=this.container.find(".toggleFilters");if(c.on("click",function(a){var b=c.getPosition();a.stopPropagation();b.x-this.filterContainer.getWidth(),b.y+c.getHeight();this.filterContainer.toggle(),this.filtersInHeadings.toggle()}.bind(this)),this.filterContainer.hide(),this.filtersInHeadings.toggle(),"null"!==typeOf(this.container)){this.getList();var d=this.container.find(".clearFilters");d.removeEvents(),d.addEvent("click",function(a){var b;a.stopPropagation(),this.container.find(".fabrik_filter").each(function(a){(a.name.contains("[value]")||a.name.contains("fabrik_list_filter_all")||a.hasClass("autocomplete-trigger"))&&("select"===a.get("tag")?a.selectedIndex=a.get("multiple")?-1:0:"checkbox"===a.get("type")?a.checked=!1:a.value="")}),b=this.getList().plugins,"null"!==typeOf(b)&&b.each(function(a){a.clearFilter()});var c="FORM"===this.container.prop("tagName")?this.container:this.container.find("form");$("<input />").attr({name:"resetfilters",value:1,type:"hidden"}).inject(c),"list"===this.options.type?this.list.submit("list.clearfilter"):this.container.find("form[name=filter]").submit()}.bind(this)),(b=this.container.find(".advanced-search-link"))&&b.on("click",function(a){a.stopPropagation();var b=a.target;"A"!==b.prop("tagName")&&(b=b.closest("a"));var c=b.href;c+="&listref="+this.options.ref,this.windowopts={id:"advanced-search-win"+this.options.ref,title:Joomla.JText._("COM_FABRIK_ADVANCED_SEARCH"),loadMethod:"xhr",evalScripts:!0,contentURL:c,width:710,height:340,y:this.options.popwiny,onContentLoaded:function(){var a=Fabrik.blocks["list_"+this.options.ref];"null"===typeOf(a)&&(a=Fabrik.blocks[this.options.container],this.options.advancedSearch.parentView=this.options.container),a.advancedSearch=new AdvancedSearch(this.options.advancedSearch),d.fitToContent(!1)}.bind(this)};var d=Fabrik.getWindow(this.windowopts)}.bind(this))}},getList:function(){return this.list=Fabrik.blocks[this.options.type+"_"+this.options.ref],"null"===typeOf(this.list)&&(this.list=Fabrik.blocks[this.options.container]),this.list},addFilter:function(a,b){this.filters.hasOwnProperty(a)===!1&&(this.filters[a]=[]),this.filters[a].push(b)},onSubmit:function(){this.filters.date&&jQuery.each(this.filters.date,function(a,b){b.onSubmit()})},onUpdateData:function(){this.filters.date&&jQuery.each(this.filters.date,function(a,b){b.onUpdateData()})},getFilterData:function(){var a={};return this.container.find(".fabrik_filter").each(function(b){if(b.id.test(/value$/)){var c=b.id.match(/(\S+)value$/)[1];a[c]="select"===b.get("tag")&&-1!==b.selectedIndex?document.id(b.options[b.selectedIndex]).get("text"):b.get("value"),a[c+"_raw"]=b.get("value")}}.bind(this)),a},update:function(){jQuery.each(this.filters,function(a,b){b.each(function(a){a.update()}.bind(this))}.bind(this))}});