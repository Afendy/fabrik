var FbList=new Class({Implements:[Options,Events],options:{admin:false,filterMethod:"onchange",ajax:false,ajax_links:false,links:{edit:"",detail:"",add:""},form:"listform_"+this.id,hightLight:"#ccffff",primaryKey:"",headings:[],labels:{},Itemid:0,formid:0,canEdit:true,canView:true,page:"index.php",actionMethod:"floating",formels:[],data:[],rowtemplate:"",floatPos:"left",csvChoose:false,csvOpts:{},popup_width:300,popup_height:300,popup_offset_x:null,popup_offset_y:null,groupByOpts:{},listRef:"",fabrik_show_in_list:[],singleOrdering:false,tmpl:"",groupedBy:"",toggleCols:false},initialize:function(e,t){this.id=e;this.setOptions(t);this.getForm();this.result=true;this.plugins=[];this.list=document.id("list_"+this.options.listRef);if(this.options.j3===false){this.actionManager=new FbListActions(this,{method:this.options.actionMethod,floatPos:this.options.floatPos})}if(this.options.toggleCols){this.toggleCols=new FbListToggle(this.form)}this.groupToggle=new FbGroupedToggler(this.form,this.options.groupByOpts);new FbListKeys(this);if(this.list){if(this.list.get("tag")==="table"){this.tbody=this.list.getElement("tbody")}if(typeOf(this.tbody)==="null"){this.tbody=this.list}if(window.ie){this.options.rowtemplate=this.list.getElement(".fabrik_row")}}this.watchAll(false);Fabrik.addEvent("fabrik.form.submitted",function(){this.updateRows()}.bind(this));if(!!(window.history&&history.pushState)&&history.state&&this.options.ajax){this._updateRows(history.state)}},setRowTemplate:function(){if(typeOf(this.options.rowtemplate)==="string"){var e=this.list.getElement(".fabrik_row");if(window.ie&&typeOf(e)!=="null"){this.options.rowtemplate=e}}},rowClicks:function(){this.list.addEvent("click:relay(.fabrik_row)",function(e,t){var n=Array.from(t.id.split("_")),r={};r.rowid=n.getLast();var i={errors:{},data:r,rowid:n.getLast(),listid:this.id};Fabrik.fireEvent("fabrik.list.row.selected",i)}.bind(this))},watchAll:function(e){e=e?e:false;this.watchNav();if(!e){this.watchRows()}this.watchFilters();this.watchOrder();this.watchEmpty();this.watchButtons()},watchButtons:function(){this.exportWindowOpts={id:"exportcsv",title:"Export CSV",loadMethod:"html",minimizable:false,width:360,height:120,content:"",bootstrap:this.options.j3};if(this.options.view==="csv"){this.openCSVWindow()}else{if(this.form.getElements(".csvExportButton")){this.form.getElements(".csvExportButton").each(function(e){if(e.hasClass("custom")===false){e.addEvent("click",function(e){this.openCSVWindow();e.stop()}.bind(this))}}.bind(this))}}},openCSVWindow:function(){var e=this.makeCSVExportForm();this.exportWindowOpts.content=e;this.exportWindowOpts.onContentLoaded=function(){this.fitToContent()};this.csvWindow=Fabrik.getWindow(this.exportWindowOpts)},makeCSVExportForm:function(){if(this.options.csvChoose){return this._csvExportForm()}else{return this._csvAutoStart()}},_csvAutoStart:function(){var e=(new Element("div",{id:"csvmsg"})).set("html",Joomla.JText._("COM_FABRIK_LOADING")+' <br /><span id="csvcount">0</span> / <span id="csvtotal"></span> '+Joomla.JText._("COM_FABRIK_RECORDS")+".<br/>"+Joomla.JText._("COM_FABRIK_SAVING_TO")+'<span id="csvfile"></span>');this.csvopts=this.options.csvOpts;this.csvfields=this.options.csvFields;this.triggerCSVExport(-1);return e},_csvExportForm:function(){var e="<input type='radio' value='1' name='incfilters' checked='checked' />"+Joomla.JText._("JYES");var t="<input type='radio' value='1' name='incraw' checked='checked' />"+Joomla.JText._("JYES");var n="<input type='radio' value='1' name='inccalcs' checked='checked' />"+Joomla.JText._("JYES");var r="<input type='radio' value='1' name='inctabledata' checked='checked' />"+Joomla.JText._("JYES");var i="<input type='radio' value='1' name='excel' checked='checked' />Excel CSV";var s="index.php?option=com_fabrik&view=list&listid="+this.id+"&format=csv&Itemid="+this.options.Itemid;var o={styles:{width:"200px","float":"left"}};var u=(new Element("form",{action:s,method:"post"})).adopt([(new Element("div",o)).set("text",Joomla.JText._("COM_FABRIK_FILE_TYPE")),(new Element("label")).set("html",i),(new Element("label")).adopt([new Element("input",{type:"radio",name:"excel",value:"0"}),(new Element("span")).set("text","CSV")]),new Element("br"),new Element("br"),(new Element("div",o)).appendText(Joomla.JText._("COM_FABRIK_INCLUDE_FILTERS")),(new Element("label")).set("html",e),(new Element("label")).adopt([new Element("input",{type:"radio",name:"incfilters",value:"0"}),(new Element("span")).set("text",Joomla.JText._("JNO"))]),new Element("br"),(new Element("div",o)).appendText(Joomla.JText._("COM_FABRIK_INCLUDE_DATA")),(new Element("label")).set("html",r),(new Element("label")).adopt([new Element("input",{type:"radio",name:"inctabledata",value:"0"}),(new Element("span")).set("text",Joomla.JText._("JNO"))]),new Element("br"),(new Element("div",o)).appendText(Joomla.JText._("COM_FABRIK_INCLUDE_RAW_DATA")),(new Element("label")).set("html",t),(new Element("label")).adopt([new Element("input",{type:"radio",name:"incraw",value:"0"}),(new Element("span")).set("text",Joomla.JText._("JNO"))]),new Element("br"),(new Element("div",o)).appendText(Joomla.JText._("COM_FABRIK_INLCUDE_CALCULATIONS")),(new Element("label")).set("html",n),(new Element("label")).adopt([new Element("input",{type:"radio",name:"inccalcs",value:"0"}),(new Element("span")).set("text",Joomla.JText._("JNO"))])]);(new Element("h4")).set("text",Joomla.JText._("COM_FABRIK_SELECT_COLUMNS_TO_EXPORT")).inject(u);var a="";var f=0;$H(this.options.labels).each(function(e,t){if(t.substr(0,7)!=="fabrik_"&&t!=="____form_heading"){var n=t.split("___")[0];if(n!==a){a=n;(new Element("h5")).set("text",a).inject(u)}var r="<input type='radio' value='1' name='fields["+t+"]' checked='checked' />"+Joomla.JText._("JYES");e=e.replace(/<\/?[^>]+(>|$)/g,"");var i=(new Element("div",o)).appendText(e);i.inject(u);(new Element("label")).set("html",r).inject(u);(new Element("label")).adopt([new Element("input",{type:"radio",name:"fields["+t+"]",value:"0"}),(new Element("span")).appendText(Joomla.JText._("JNO"))]).inject(u);(new Element("br")).inject(u)}f++}.bind(this));if(this.options.formels.length>0){(new Element("h5")).set("text",Joomla.JText._("COM_FABRIK_FORM_FIELDS")).inject(u);this.options.formels.each(function(e){var t="<input type='radio' value='1' name='fields["+e.name+"]' checked='checked' />"+Joomla.JText._("JYES");var n=(new Element("div",o)).appendText(e.label);n.inject(u);(new Element("label")).set("html",t).inject(u);(new Element("label")).adopt([new Element("input",{type:"radio",name:"fields["+e.name+"]",value:"0"}),(new Element("span")).set("text",Joomla.JText._("JNO"))]).inject(u);(new Element("br")).inject(u)}.bind(this))}(new Element("div",{styles:{"text-align":"right"}})).adopt(new Element("input",{type:"button",name:"submit",value:Joomla.JText._("COM_FABRIK_EXPORT"),"class":"button exportCSVButton",events:{click:function(e){e.stop();e.target.disabled=true;var t=document.id("csvmsg");if(typeOf(t)==="null"){t=(new Element("div",{id:"csvmsg"})).inject(e.target,"before")}t.set("html",Joomla.JText._("COM_FABRIK_LOADING")+' <br /><span id="csvcount">0</span> / <span id="csvtotal"></span> '+Joomla.JText._("COM_FABRIK_RECORDS")+".<br/>"+Joomla.JText._("COM_FABRIK_SAVING_TO")+'<span id="csvfile"></span>');this.triggerCSVExport(0)}.bind(this)}})).inject(u);(new Element("input",{type:"hidden",name:"view",value:"table"})).inject(u);(new Element("input",{type:"hidden",name:"option",value:"com_fabrik"})).inject(u);(new Element("input",{type:"hidden",name:"listid",value:this.id})).inject(u);(new Element("input",{type:"hidden",name:"format",value:"csv"})).inject(u);(new Element("input",{type:"hidden",name:"c",value:"table"})).inject(u);return u},triggerCSVExport:function(e,t,n){if(e!==0){if(e===-1){e=0;t=this.csvopts;t.fields=this.csvfields}else{t=this.csvopts;n=this.csvfields}}else{if(!t){t={};if(typeOf(document.id("exportcsv"))!=="null"){["incfilters","inctabledata","incraw","inccalcs","excel"].each(function(e){var n=document.id("exportcsv").getElements("input[name="+e+"]");if(n.length>0){t[e]=n.filter(function(e){return e.checked})[0].value}})}}if(!n){n={};if(typeOf(document.id("exportcsv"))!=="null"){document.id("exportcsv").getElements("input[name^=field]").each(function(e){if(e.checked){var t=e.name.replace("fields[","").replace("]","");n[t]=e.get("value")}})}}t.fields=n;this.csvopts=t;this.csvfields=n}t=this.csvExportFilterOpts(t);t.start=e;t.option="com_fabrik";t.view="list";t.format="csv";t.Itemid=this.options.Itemid;t.listid=this.id;t.listref=this.id;this.options.csvOpts.custom_qs.split("&").each(function(e){var n=e.split("=");t[n[0]]=n[1]});var r=new Request.JSON({url:"?"+this.options.csvOpts.custom_qs,method:"post",data:t,onError:function(e,t){fconsole(e,t)},onFailure:function(e){fconsole("failed",r)},onSuccess:function(e){if(e.err){alert(e.err);Fabrik.Windows.exportcsv.close()}else{if(typeOf(document.id("csvcount"))!=="null"){document.id("csvcount").set("text",e.count)}if(typeOf(document.id("csvtotal"))!=="null"){document.id("csvtotal").set("text",e.total)}if(typeOf(document.id("csvfile"))!=="null"){document.id("csvfile").set("text",e.file)}if(e.count<e.total){this.triggerCSVExport(e.count)}else{var t="index.php?option=com_fabrik&view=list&format=csv&listid="+this.id+"&start="+e.count+"&Itemid="+this.options.Itemid;var n='<div class="alert alert-success"><h3>'+Joomla.JText._("COM_FABRIK_CSV_COMPLETE");n+='</h3><p><a class="btn btn-success" href="'+t+'"><i class="icon-download"></i> '+Joomla.JText._("COM_FABRIK_CSV_DOWNLOAD_HERE")+"</a></p></div>";if(typeOf(document.id("csvmsg"))!=="null"){document.id("csvmsg").set("html",n)}this.csvWindow.fitToContent();document.getElements("input.exportCSVButton").removeProperty("disabled")}}}.bind(this)});r.send()},csvExportFilterOpts:function(e){var t=0,n,r=0,i,s=["origvalue","value","condition","join","key","search_type","match","full_words_only","eval","grouped_to_previous","hidden","elementid"];Fabrik["filter_listform_"+this.options.listRef].onSubmit();this.getFilters().each(function(n){i=n.name.split("[").getLast().replace("]","").toInt();t=i>t?i:t;e[n.name]=n.get("value")}.bind(this));t++;Object.each(this.options.advancedFilters,function(i,o){if(s.contains(o)){r=0;for(n=0;n<i.length;n++){r=n+t;aName="fabrik___filter[list_"+this.options.listRef+"]["+o+"]["+r+"]";e[aName]=i[n]}}}.bind(this));return e},addPlugins:function(e){e.each(function(e){e.list=this}.bind(this));this.plugins=e},firePlugin:function(e){var t=Array.prototype.slice.call(arguments);t=t.slice(1,t.length);this.plugins.each(function(n){Fabrik.fireEvent(e,[this,t])}.bind(this));return this.result===false?false:true},watchEmpty:function(e){var t=document.id(this.options.form).getElement(".doempty",this.options.form);if(t){t.addEvent("click",function(e){e.stop();if(confirm(Joomla.JText._("COM_FABRIK_CONFIRM_DROP"))){this.submit("list.doempty")}}.bind(this))}},watchOrder:function(){var e=false;var t=document.id(this.options.form).getElements(".fabrikorder, .fabrikorder-asc, .fabrikorder-desc");t.removeEvents("click");t.each(function(t){t.addEvent("click",function(n){var r="ordernone.png",i="",s="",o;t=document.id(n.target);var u=t.getParent(".fabrik_ordercell");if(t.tagName!=="a"){t=u.getElement("a")}switch(t.className){case"fabrikorder-asc":s="fabrikorder-desc";o="icon-arrow-up";i="desc";r="orderdesc.png";break;case"fabrikorder-desc":s="fabrikorder";o="icon-menu-2";i="-";r="ordernone.png";break;case"fabrikorder":s="fabrikorder-asc";o="icon-arrow-down";i="asc";r="orderasc.png";break}u.className.split(" ").each(function(t){if(t.contains("_order")){e=t.replace("_order","").replace(/^\s+/g,"").replace(/\s+$/g,"")}});if(!e){fconsole("woops didnt find the element id, cant order");return}t.className=s;var a=t.getElement("img");var f=t.getElement('*[class^="icon"]');if(this.options.singleOrdering){document.id(this.options.form).getElements(".fabrikorder, .fabrikorder-asc, .fabrikorder-desc").each(function(e){var t=e.getElement("img");if(t){t.src=t.src.replace("ordernone.png","").replace("orderasc.png","").replace("orderdesc.png","");t.src+="ordernone.png"}})}if(a){a.src=a.src.replace("ordernone.png","").replace("orderasc.png","").replace("orderdesc.png","");a.src+=r}this.fabrikNavOrder(e,i);n.stop()}.bind(this))}.bind(this))},getFilters:function(){return document.id(this.options.form).getElements(".fabrik_filter")},storeCurrentValue:function(){this.getFilters().each(function(e){if(this.options.filterMethod!=="submitform"){e.store("initialvalue",e.get("value"))}}.bind(this))},watchFilters:function(){var e="";var t=document.id(this.options.form).getElements(".fabrik_filter_submit");this.getFilters().each(function(n){e=n.get("tag")==="select"?"change":"blur";if(this.options.filterMethod!=="submitform"){n.removeEvent(e);n.store("initialvalue",n.get("value"));n.addEvent(e,function(e){e.stop();if(e.target.retrieve("initialvalue")!==e.target.get("value")){this.doFilter()}}.bind(this))}else{n.addEvent(e,function(e){t.highlight("#ffaa00")}.bind(this))}}.bind(this));if(t){t.removeEvents();t.addEvent("click",function(e){e.stop();this.doFilter()}.bind(this))}this.getFilters().addEvent("keydown",function(e){if(e.code===13){e.stop();this.doFilter()}}.bind(this))},doFilter:function(){var e=Fabrik.fireEvent("list.filter",[this]).eventResults;if(typeOf(e)==="null"){this.submit("list.filter")}if(e.length===0||!e.contains(false)){this.submit("list.filter")}},setActive:function(e){this.list.getElements(".fabrik_row").each(function(e){e.removeClass("activeRow")});e.addClass("activeRow")},getActiveRow:function(e){var t=e.target.getParent(".fabrik_row");if(!t){t=Fabrik.activeRow}return t},watchRows:function(){if(!this.list){return}this.rowClicks()},getForm:function(){if(!this.form){this.form=document.id(this.options.form)}return this.form},uncheckAll:function(){this.form.getElements("input[name^=ids]").each(function(e){e.checked=""})},submit:function(e){this.getForm();if(e==="list.delete"){var t=false;var n=0;this.form.getElements("input[name^=ids]").each(function(e){if(e.checked){n++;t=true}});if(!t){alert(Joomla.JText._("COM_FABRIK_SELECT_ROWS_FOR_DELETION"));Fabrik.loader.stop("listform_"+this.options.listRef);return false}var r=n===1?Joomla.JText._("COM_FABRIK_CONFIRM_DELETE_1"):Joomla.JText._("COM_FABRIK_CONFIRM_DELETE").replace("%s",n);if(!confirm(r)){Fabrik.loader.stop("listform_"+this.options.listRef);this.uncheckAll();return false}}if(e==="list.filter"){Fabrik["filter_listform_"+this.options.listRef].onSubmit();this.form.task.value=e;if(this.form["limitstart"+this.id]){this.form.getElement("#limitstart"+this.id).value=0}}else{if(e!==""){this.form.task.value=e}}if(this.options.ajax){Fabrik.loader.start("listform_"+this.options.listRef);this.form.getElement("input[name=option]").value="com_fabrik";this.form.getElement("input[name=view]").value="list";this.form.getElement("input[name=format]").value="raw";var i=this.form.toQueryString();if(e==="list.filter"&&this.advancedSearch!==false){var s=document.getElement("form.advancedSeach_"+this.options.listRef);if(typeOf(s)!=="null"){i+="&"+s.toQueryString();i+="&replacefilters=1"}}for(var o=0;o<this.options.fabrik_show_in_list.length;o++){i+="&fabrik_show_in_list[]="+this.options.fabrik_show_in_list[o]}i+="&tmpl="+this.options.tmpl;if(!this.request){this.request=new Request({url:this.form.get("action"),data:i,onComplete:function(e){e=JSON.decode(e);this._updateRows(e);Fabrik.loader.stop("listform_"+this.options.listRef);Fabrik["filter_listform_"+this.options.listRef].onUpdateData();Fabrik.fireEvent("fabrik.list.submit.ajax.complete",[this,e]);if(e.msg){alert(e.msg)}}.bind(this)})}else{this.request.options.data=i}this.request.send();if(window.history&&window.history.pushState){history.pushState(i,"fabrik.list.submit")}Fabrik.fireEvent("fabrik.list.submit",[e,this.form.toQueryString().toObject()])}else{this.form.submit()}return false},fabrikNav:function(e){this.options.limitStart=e;this.form.getElement("#limitstart"+this.id).value=e;Fabrik.fireEvent("fabrik.list.navigate",[this,e]);if(!this.result){this.result=true;return false}this.submit("list.view");return false},getRowIds:function(){var e=[];$H(this.options.data).each(function(t){t.each(function(t){e.push(t.data.__pk_val)})});return e},getRow:function(e){var t={};Object.each(this.options.data,function(n){for(var r=0;r<n.length;r++){var i=n[r];if(i&&i.data.__pk_val===e){t=i.data}}});return t},fabrikNavOrder:function(e,t){this.form.orderby.value=e;this.form.orderdir.value=t;Fabrik.fireEvent("fabrik.list.order",[this,e,t]);if(!this.result){this.result=true;return false}this.submit("list.order")},removeRows:function(e){for(i=0;i<e.length;i++){var t=document.id("list_"+this.id+"_row_"+e[i]);var n=new Fx.Morph(t,{duration:1e3});n.start({backgroundColor:this.options.hightLight}).chain(function(){this.start({opacity:0})}).chain(function(){t.dispose();this.checkEmpty()}.bind(this))}},editRow:function(){},clearRows:function(){this.list.getElements(".fabrik_row").each(function(e){e.dispose()})},updateRows:function(){var e={option:"com_fabrik",view:"list",task:"list.view",format:"raw",listid:this.id,group_by:this.options.groupedBy,listref:this.options.listRef};var t="";e["limit"+this.id]=this.options.limitLength;(new Request.JSON({url:t,data:e,onSuccess:function(e){this._updateRows(e)}.bind(this),onError:function(e,t){fconsole(e,t)},onFailure:function(e){fconsole(e)}})).send()},_updateRows:function(e){var t;if(typeOf(e)!=="object"){return}if(window.history&&window.history.pushState){history.pushState(e,"fabrik.list.rows")}if(e.id===this.id&&e.model==="list"){var n=document.id(this.options.form).getElements(".fabrik___heading").getLast();var r=new Hash(e.headings);r.each(function(e,t){t="."+t;try{if(typeOf(n.getElement(t))!=="null"){n.getElement(t).getElement("span").set("html",e)}}catch(r){fconsole(r)}});this.setRowTemplate();this.clearRows();var s=0;var o=0;trs=[];this.options.data=this.options.isGrouped?$H(e.data):e.data;if(e.calculations){this.updateCals(e.calculations)}if(typeOf(this.form.getElement(".fabrikNav"))!=="null"){this.form.getElement(".fabrikNav").set("html",e.htmlnav)}var u=this.options.isGrouped?$H(e.data):e.data;var a=0;u.each(function(e,n){var r,u;t=this.options.isGrouped?this.list.getElements(".fabrik_groupdata")[a]:this.tbody;if(this.options.isGrouped&&t){groupHeading=t.getPrevious();groupHeading.getElement(".groupTitle").set("html",e[0].groupHeading)}if(typeOf(t)!=="null"){a++;for(i=0;i<e.length;i++){if(typeOf(this.options.rowtemplate)==="string"){r=this.options.rowtemplate.trim().slice(0,3)==="<tr"?"table":"div";u=new Element(r);u.set("html",this.options.rowtemplate)}else{r=this.options.rowtemplate.get("tag")==="tr"?"table":"div";u=new Element(r);u.adopt(this.options.rowtemplate.clone())}var f=$H(e[i]);$H(f.data).each(function(e,t){var n="."+t;var r=u.getElement(n);if(typeOf(r)!=="null"&&r.get("tag")!=="a"){r.set("html",e)}o++}.bind(this));u.getElement(".fabrik_row").id=f.id;if(typeOf(this.options.rowtemplate)==="string"){var l=u.getElement(".fabrik_row").clone();l.id=f.id;var c=f["class"].split(" ");for(j=0;j<c.length;j++){l.addClass(c[j])}l.inject(t)}else{var h=u.getElement(".fabrik_row");h.inject(t);u.empty()}s++}}}.bind(this));var f=this.list.getElements("tbody");f.setStyle("display","");f.each(function(e){if(!e.hasClass("fabrik_groupdata")){var t=e.getNext();if(typeOf(t)!=="null"){if(t.getElements(".fabrik_row").length===0){e.hide();t.hide()}}}});var l=this.list.getParent(".fabrikDataContainer");var c=this.list.getParent(".fabrikForm").getElement(".emptyDataMessage");if(o===0){if(typeOf(c)!=="null"){c.setStyle("display","")}}else{if(typeOf(l)!=="null"){l.setStyle("display","")}if(typeOf(c)!=="null"){c.setStyle("display","none")}}if(typeOf(this.form.getElement(".fabrikNav"))!=="null"){this.form.getElement(".fabrikNav").set("html",e.htmlnav)}this.watchAll(true);Fabrik.fireEvent("fabrik.list.updaterows");Fabrik.fireEvent("fabrik.list.update",[this,e])}this.stripe();Fabrik.loader.stop("listform_"+this.options.listRef)},addRow:function(e){var t=new Element("tr",{"class":"oddRow1"});var n={test:"hi"};for(var r in e){if(this.options.headings.indexOf(r)!==-1){var i=(new Element("td",{})).appendText(e[r]);t.appendChild(i)}}t.inject(this.tbody)},addRows:function(e){for(i=0;i<e.length;i++){for(j=0;j<e[i].length;j++){this.addRow(e[i][j])}}this.stripe()},stripe:function(){var e=this.list.getElements(".fabrik_row");for(i=0;i<e.length;i++){if(!e[i].hasClass("fabrik___header")){var t="oddRow"+i%2;e[i].addClass(t)}}},checkEmpty:function(){var e=this.list.getElements("tr");if(e.length===2){this.addRow({label:Joomla.JText._("COM_FABRIK_NO_RECORDS")})}},watchCheckAll:function(e){var t=this.form.getElement("input[name=checkAll]");if(typeOf(t)!=="null"){t.addEvent("click",function(e){var t=this.list.getParent(".fabrikList")?this.list.getParent(".fabrikList"):this.list;var n=t.getElements("input[name^=ids]");c=!e.target.checked?"":"checked";for(var r=0;r<n.length;r++){n[r].checked=c;this.toggleJoinKeysChx(n[r])}}.bind(this))}this.form.getElements("input[name^=ids]").each(function(e){e.addEvent("change",function(t){this.toggleJoinKeysChx(e)}.bind(this))}.bind(this))},toggleJoinKeysChx:function(e){e.getParent().getElements("input[class=fabrik_joinedkey]").each(function(t){t.checked=e.checked})},watchNav:function(e){var t=this.form.getElement("select[name*=limit]");if(t){t.addEvent("change",function(e){var t=Fabrik.fireEvent("fabrik.list.limit",[this]);if(this.result===false){this.result=true;return false}this.doFilter()}.bind(this))}var n=this.form.getElement(".addRecord");if(typeOf(n)!=="null"&&this.options.ajax_links){n.removeEvents();var r=this.options.links.add===""||n.href.contains(Fabrik.liveSite)?"xhr":"iframe";var i=n.href;i+=i.contains("?")?"&":"?";i+="tmpl=component&ajax=1";n.addEvent("click",function(e){e.stop();var t={id:"add."+this.id,title:this.options.popup_add_label,loadMethod:r,contentURL:i,width:this.options.popup_width,height:this.options.popup_height};if(typeOf(this.options.popup_offset_x)!=="null"){t.offset_x=this.options.popup_offset_x}if(typeOf(this.options.popup_offset_y)!=="null"){t.offset_y=this.options.popup_offset_y}Fabrik.getWindow(t)}.bind(this))}if(document.id("fabrik__swaptable")){document.id("fabrik__swaptable").addEvent("change",function(e){window.location="index.php?option=com_fabrik&task=list.view&cid="+e.target.get("value")}.bind(this))}if(typeOf(this.form.getElement(".pagination"))!=="null"){var s=this.form.getElement(".pagination").getElements(".pagenav");if(s.length===0){s=this.form.getElement(".pagination").getElements("a")}s.each(function(e){e.addEvent("click",function(t){t.stop();if(e.get("tag")==="a"){var n=e.href.toObject();this.fabrikNav(n["limitstart"+this.id])}}.bind(this))}.bind(this))}this.watchCheckAll()},updateCals:function(e){var t=["sums","avgs","count","medians"];this.form.getElements(".fabrik_calculations").each(function(n){t.each(function(t){$H(e[t]).each(function(e,t){var r=n.getElement(".fabrik_row___"+t);if(typeOf(r)!=="null"){r.set("html",e)}})})})}});var FbListKeys=new Class({initialize:function(e){window.addEvent("keyup",function(t){if(t.alt){switch(t.key){case Joomla.JText._("COM_FABRIK_LIST_SHORTCUTS_ADD"):var n=e.form.getElement(".addRecord");if(e.options.ajax){n.fireEvent("click")}if(n.getElement("a")){e.options.ajax?n.getElement("a").fireEvent("click"):document.location=n.getElement("a").get("href")}else{if(!e.options.ajax){document.location=n.get("href")}}break;case Joomla.JText._("COM_FABRIK_LIST_SHORTCUTS_EDIT"):fconsole("edit");break;case Joomla.JText._("COM_FABRIK_LIST_SHORTCUTS_DELETE"):fconsole("delete");break;case Joomla.JText._("COM_FABRIK_LIST_SHORTCUTS_FILTER"):fconsole("filter");break}}}.bind(this))}});var FbGroupedToggler=new Class({Implements:Options,options:{collapseOthers:false,startCollapsed:false,bootstrap:false},initialize:function(e,t){var n,r,i,s;if(typeOf(e)==="null"){return}this.setOptions(t);this.container=e;this.toggleState="shown";if(this.options.startCollapsed&&this.options.isGrouped){this.collapse()}e.addEvent("click:relay(.fabrik_groupheading a.toggle)",function(e){if(e.rightClick){return}e.stop();e.preventDefault();if(this.options.collapseOthers){this.collapse()}r=e.target.getParent(".fabrik_groupheading");i=this.options.bootstrap?r.getElement("i"):r.getElement("img");s=i.retrieve("showgroup",true);if(r.getNext()&&r.getNext().hasClass("fabrik_groupdata")){n=r.getNext()}else{n=r.getParent().getNext()}s?n.hide():n.show();this.setIcon(i,s);s=s?false:true;i.store("showgroup",s);return false}.bind(this))},setIcon:function(e,t){if(this.options.bootstrap){if(!t){e.removeClass("icon-arrow-right");e.addClass("icon-arrow-down")}else{e.addClass("icon-arrow-right");e.removeClass("icon-arrow-down")}}else{if(t){e.src=e.src.replace("orderasc","orderneutral")}else{e.src=e.src.replace("orderneutral","orderasc")}}},collapse:function(){this.container.getElements(".fabrik_groupdata").hide();var e=this.options.bootstrap?"i":"img";var t=this.container.getElements(".fabrik_groupheading a "+e);if(t.length===0){t=this.container.getElements(".fabrik_groupheading "+e)}t.each(function(e){e.store("showgroup",false);this.setIcon(e,true)}.bind(this))},expand:function(){this.container.getElements(".fabrik_groupdata").show();var e=this.container.getElements(".fabrik_groupheading a img");if(e.length===0){e=this.container.getElements(".fabrik_groupheading img")}e.each(function(e){e.store("showgroup",true);this.setIcon(e,false)}.bind(this))},toggle:function(){this.toggleState==="shown"?this.collapse():this.expand();this.toggleState=this.toggleState==="shown"?"hidden":"shown"}});var FbListActions=new Class({Implements:[Options],options:{selector:"ul.fabrik_action, .btn-group.fabrik_action",method:"floating",floatPos:"bottom"},initialize:function(e,t){this.setOptions(t);this.list=e;this.actions=[];this.setUpSubMenus();Fabrik.addEvent("fabrik.list.update",function(e,t){this.observe()}.bind(this));this.observe()},observe:function(){if(this.options.method==="floating"){this.setUpFloating()}else{this.setUpDefault()}},setUpSubMenus:function(){if(!this.list.form){return}this.actions=this.list.form.getElements(this.options.selector);this.actions.each(function(e){if(e.getElement("ul")){var t=e.getElement("ul");var n=(new Element("div")).adopt(t.clone());var r=t.getPrevious();if(r.getElement(".fabrikTip")){r=r.getElement(".fabrikTip")}var i=Fabrik.tips?Fabrik.tips.options:{};var s=Object.merge(Object.clone(i),{showOn:"click",hideOn:"click",position:"bottom",content:n});var o=new FloatingTips(r,s);t.dispose()}})},setUpDefault:function(){this.actions=this.list.form.getElements(this.options.selector);this.actions.each(function(e){if(e.getParent().hasClass("fabrik_buttons")){return}e.fade(.6);var t=e.getParent(".fabrik_row")?e.getParent(".fabrik_row"):e.getParent(".fabrik___heading");if(t){t.addEvents({mouseenter:function(t){e.fade(.99)},mouseleave:function(t){e.fade(.6)}})}})},setUpFloating:function(){var e=false;this.list.form.getElements(this.options.selector).each(function(t){if(t.getParent(".fabrik_row")){if(i=t.getParent(".fabrik_row").getElement("input[type=checkbox]")){e=true;var n=function(e,t,n){if(!e.target.checked){this.hide(e,t)}if(n==="tip"){}};var r=function(e,n){var r=t.getParent();r.store("activeRow",t.getParent(".fabrik_row"));return r}.bind(this.list);var s={position:this.options.floatPos,showOn:"change",hideOn:"click",content:r,heading:"Edit: ",hideFn:function(e){return!e.target.checked},showFn:function(e,n){Fabrik.activeRow=t.getParent().retrieve("activeRow");n.store("list",this.list);return e.target.checked}.bind(this.list)};var o=Fabrik.tips?Object.merge(Object.clone(Fabrik.tips.options),s):s;var u=new FloatingTips(i,o)}}}.bind(this));this.list.form.getElements(".fabrik_select input[type=checkbox]").addEvent("click",function(e){Fabrik.activeRow=e.target.getParent(".fabrik_row")});var t=this.list.form.getElement("input[name=checkAll]");if(typeOf(t)!=="null"){t.store("listid",this.list.id)}var n=function(e){var t=e.getParent(".fabrik___heading");return typeOf(t)!=="null"?t.getElement(this.options.selector):""}.bind(this);var r=Fabrik.tips?Object.clone(Fabrik.tips.options):{};var s=Object.merge(r,{position:this.options.floatPos,html:true,showOn:"click",hideOn:"click",content:n,heading:"Edit all: ",hideFn:function(e){return!e.target.checked},showFn:function(e,t){t.retrieve("tip").click.store("list",this.list);return e.target.checked}.bind(this.list)});var o=new FloatingTips(t,s);if(this.list.form.getElements(".fabrik_actions")){this.list.form.getElements(".fabrik_actions").hide()}if(this.list.form.getElements(".fabrik_calculation")){var u=this.list.form.getElements(".fabrik_calculation").getLast();if(typeOf(u)!=="null"){u.hide()}}}})