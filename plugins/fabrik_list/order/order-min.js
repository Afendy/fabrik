/*! Fabrik */
var FbListOrder=my.Class(FbListPlugin,{constructor:function(a){this.parent(a),document.ondragstart=function(){return!1},this.sortables={},this.origorder={},this.neworder={};var b=Fabrik.blocks["list_"+this.options.ref].options.isGrouped,c=this.getList().list;if(b){var d=c.getElements("tbody.fabrik_groupdata");d.each(function(a,b){a.setProperty("data-order",b),console.log(a,b),this.makeSortable(a)}.bind(this))}else c.css("position","relative"),"null"!==typeOf(c.getElement("tbody"))&&(c=c.getElement("tbody")),this.makeSortable(c);return this.options.handle!==!1&&0===c.getElements(this.options.handle).length?void fconsole("order: handle selected ("+this.options.handle+") but not found in container"):void(a.enabled===!1?(fconsole("drag n drop reordering not enabled - need to order by ordering element"),this.sortable.detach()):this.options.handle?c.getElements(this.options.handle).css("cursor","move"):c.getChildren().css("cursor","move"))},makeSortable:function(a){var b=this,c=new Sortables(a,{clone:!0,constrain:!1,revert:!0,opacity:.7,transition:"elastic:out",handle:this.options.handle,onComplete:function(a,c){c?c.removeClass("fabrikDragSelected"):a.removeClass("fabrikDragSelected");var d=a.closest("tbody"),e=this.sortables[d.getProperty("data-order")];this.neworder[d]=this.getOrder(e),Fabrik.loader.start("list_"+this.options.ref,"sorting",!0),$.ajax({url:"index.php",data:{option:"com_fabrik",format:"raw",task:"plugin.pluginAjax",plugin:"order",g:"list",listref:this.options.ref,method:"ajaxReorder",order:this.neworder[d],origorder:this.origorder[d],dragged:this.getRowId(a),listid:this.options.listid,orderelid:this.options.orderElementId,direction:this.options.direction}}).complete(function(){Fabrik.loader.stop("list_"+b.options.ref,null,!0),b.origorder[d]=b.neworder[d]})}.bind(this),onStart:function(a,c){var d=a.closest("tbody"),e=b.sortables[d.getProperty("data-order")];this.origorder[d]=b.getOrder(e),c?c.addClass("fabrikDragSelected"):a.addClass("fabrikDragSelected")}});this.sortables[a.getProperty("data-order")]=c},getRowId:function(a){return"null"===typeOf(a.getProperty("id"))?null:a.getProperty("id").replace("list_"+this.options.ref+"_row_","")},getOrder:function(a){var b=this;return a.serialize(0,function(a){return b.getRowId(a)}).clean()}});