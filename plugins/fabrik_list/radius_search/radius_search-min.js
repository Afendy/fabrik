/*! Fabrik */
function geoCode(){Fabrik.googleMap=!0,$(window).on("domready",function(){var a=(new google.maps.LatLng(Fabrik.radiusSearch.geocode_default_lat,Fabrik.radiusSearch.geocode_default_long),{zoom:4,mapTypeId:google.maps.MapTypeId.ROADMAP});Fabrik.radiusSearch=void 0===Fabrik.radiusSearch?{}:Fabrik.radiusSearch;var b=$(".radius_search_geocode_map");b.each(function(b){var c=b.closest(".radius_search_geocode"),d=c.find("button"),e=d?d:c.find(".radius_search_geocode_field");if(1!==parseInt(e.data("events-added",0),10)){Fabrik.radiusSearch[b.id]=void 0===Fabrik.radiusSearch[b.id]?{}:Fabrik.radiusSearch[b.id],Fabrik.radiusSearch[b.id].map=new google.maps.Map(b,a);var f=c.closest(".radius_search");e.data("events-added",1),e.data("uberC",f),e.data("mapid",b.id);var g=c.find(".radius_search_geocode_field");if(e.data("fld",g),0!==d.length)d.on("click",function(a){a.stopPropagation(),doGeoCode(e)}),g.on("keyup",function(a){"enter"===a.key&&doGeoCode(e)});else{var h;g.on("keyup",function(a){h&&clearTimeout(h),"enter"===a.key&&doGeoCode(e),h=window.setTimeout(function(){doGeoCode(e)},1e3)})}var i=parseInt(f.find("input[name=geo_code_def_zoom]").get("value"),10),j=parseInt(f.find("input[name=geo_code_def_lat]").get("value"),10),k=parseInt(f.find("input[name=geo_code_def_lon]").get("value"),10);Fabrik.trigger("google.radiusmap.loaded",[b.id,i,j,k])}})})}var doGeoCode=function(a){var b=a.data("uberC"),c=a.data("mapid"),d=a.data("fld").value,e=new google.maps.Geocoder;Fabrik.radiusSearchResults||(Fabrik.radiusSearchResults={}),Fabrik.radiusSearchResults[d]&&parseGeoCodeResult(b,c,Fabrik.radiusSearchResults[d]),e.geocode({address:d},function(a,e){e===google.maps.GeocoderStatus.OK?(parseGeoCodeResult(b,c,a[0].geometry.location),Fabrik.radiusSearchResults[d]=a[0].geometry.location):window.alert(Joomla.JText._("PLG_LIST_RADIUS_SEARCH_GEOCODE_ERROR").replace("%s",e))})},parseGeoCodeResult=function(a,b,c){a.find("input[name^=radius_search_geocode_lat]").value=c.lat(),a.find("input[name^=radius_search_geocode_lon]").value=c.lng(),Fabrik.radiusSearch[b].map.setCenter(c),Fabrik.radiusSearch[b].marker.setPosition(c)},FbListRadiusSearch=my.Class(FbListPlugin,{options:{geocode_default_lat:"0",geocode_default_long:"0",geocode_default_zoom:4,prefilter:!0,prefilterDistance:1e3,prefilterDone:!1,offset_y:0},geocoder:null,map:null,constructor:function(a){var b=this;FbListRadiusSearch.Super.call(this,a),Fabrik.radiusSearch=Fabrik.radiusSearch?Fabrik.radiusSearch:{};var c="radius_search_geocode_map"+this.options.renderOrder;if(void 0===Fabrik.radiusSearch[c]){if(Fabrik.radiusSearch[c]={},Fabrik.radiusSearch[c].geocode_default_lat=this.options.geocode_default_lat,Fabrik.radiusSearch[c].geocode_default_long=this.options.geocode_default_long,Fabrik.radiusSearch[c].geocode_default_zoom=this.options.geocode_default_zoom,Fabrik.addEvent("google.radiusmap.loaded",function(a,b,c,d){var e=new google.maps.LatLng(c,d);Fabrik.radiusSearch[a].loaded||(Fabrik.radiusSearch[a].loaded=!0,Fabrik.radiusSearch[a].map.setCenter(e),Fabrik.radiusSearch[a].map.setZoom(b),Fabrik.radiusSearch[a].marker=new google.maps.Marker({map:Fabrik.radiusSearch[a].map,draggable:!0,position:e}),google.maps.event.addListener(Fabrik.radiusSearch[a].marker,"dragend",function(){var b=Fabrik.radiusSearch[a].marker.getPosition(),c=$("#"+a).closest(".radius_search"),d=c.find("input[name^=radius_search_geocode_lat]");0!==d.length&&(d.val(b.lat()),c.find("input[name^=radius_search_geocode_lon]").val(b.lng()))}))}),Fabrik.loadGoogleMap(!0,"geoCode"),(null===this.options.value||void 0===this.options.value)&&(this.options.value=0),this.listform.length>0){if(this.listform=this.listform.find("#radius_search"+this.options.renderOrder),0===this.listform.length)return void fconsole("didnt find element #radius_search"+this.options.renderOrder);var d=this.listform.find("select[name^=radius_search_type]");d.on("change",function(a){b.toggleFields(a)}),this.listform.find("input.cancel").addEvent("click",function(){this.win.close()}.bind(this)),this.active=!1,this.listform.find(".fabrik_filter_submit").addEvent("mousedown",function(){this.active=!0,this.listform.find("input[name^=radius_search_active]").value=1}.bind(this))}if(this.options.value=parseInt(this.options.value,10),0===this.listform.length)return;var e=this.listform.find(".radius_search_distance"),f=this.listform.find(".slider_output");this.mySlide=new Slider(this.listform.find(".fabrikslider-line"),this.listform.find(".knob"),{onChange:function(a){e.value=a,f.text(a+this.options.unit)}.bind(this),steps:this.options.steps}).set(0),this.mySlide.set(this.options.value),e.value=this.options.value,f.text(this.options.value),this.options.myloc&&!this.options.prefilterDone&&geo_position_js.init()&&geo_position_js.getCurrentPosition(function(a){this.setGeoCenter(a)}.bind(this),function(a){this.geoCenterErr(a)}.bind(this),{enableHighAccuracy:!0})}Fabrik.addEvent("listfilter.clear",function(a){a.contains(this.options.ref)&&this.clearFilter()}.bind(this)),this.makeWin(c)},makeWin:function(a){var b=$("#"+a).closest(".radius_search"),c=$(document.createElement("button")).addClass("btn button").html('<i class="icon-location"></i> '+Joomla.JText._("COM_FABRIK_SEARCH"));b.parent().append(c);var d=this.options.offset_y>0?this.options.offset_y:null,e={id:"win_"+a,title:Joomla.JText._("PLG_LIST_RADIUS_SEARCH"),loadMethod:"html",content:b,width:500,height:540,offset_y:d,visible:!1,destroy:!1,onContentLoaded:function(){this.center()},onClose:function(){var a;a=!this.active&&window.confirm(Joomla.JText._("PLG_LIST_RADIUS_SEARCH_CLEAR_CONFIRM"))?0:1,this.win.window.find("input[name^=radius_search_active]").value=a}.bind(this)},f=Fabrik.getWindow(e);c.on("click",function(a){a.stopPropagation(),b.css({position:"relative",left:0});var d=c.data("win");d.center(),d.open()}),c.data("win",f),this.button=c,this.win=f,Fabrik.addEvent("list.filter",function(){return this.injectIntoListForm()}.bind(this))},injectIntoListForm:function(){var a=this.button.data("win"),b=a.contentEl.clone();return b.hide(),this.button.parent().append(b),!0},setGeoCenter:function(a){this.geocenterpoint=a,this.geoCenter(a),this.prefilter()},prefilter:function(){this.options.prefilter&&(this.mySlide.set(this.options.prefilterDistance),this.listform.find("input[name^=radius_search_active]").value=1,this.listform.find("input[value=mylocation]").checked=!0,this.list?this.getList().submit("filter"):this.listform.closest("form").submit())},geoCenter:function(a){null===a?window.alert(Joomla.JText._("PLG_VIEW_RADIUS_NO_GEOLOCATION_AVAILABLE")):(this.listform.find("input[name*=radius_search_lat]").value=a.coords.latitude.toFixed(2),this.listform.find("input[name*=radius_search_lon]").value=a.coords.longitude.toFixed(2))},geoCenterErr:function(a){fconsole("geo location error="+a.message)},toggleActive:function(){},toggleFields:function(a){var b=a.target.closest(".radius_search");switch(a.target.get("value")){case"latlon":b.find(".radius_search_place_container").hide(),b.find(".radius_search_coords_container").show(),b.find(".radius_search_geocode").css({position:"absolute",left:"-100000px"});break;case"mylocation":b.find(".radius_search_place_container").hide(),b.find(".radius_search_coords_container").hide(),b.find(".radius_search_geocode").css({position:"absolute",left:"-100000px"}),this.setGeoCenter(this.geocenterpoint);break;case"place":b.find(".radius_search_place_container").show(),b.find(".radius_search_coords_container").hide(),b.find(".radius_search_geocode").css({position:"absolute",left:"-100000px"});break;case"geocode":b.find(".radius_search_place_container").hide(),b.find(".radius_search_coords_container").hide(),b.find(".radius_search_geocode").css({position:"relative",left:0})}},clearFilter:function(){return this.listform.find("input[name^=radius_search_active]").value=0,!0}});