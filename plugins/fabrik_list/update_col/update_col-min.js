/*! Fabrik */
UpdateColSelect=my.Class({constructor:function(){this.updates={}},addFilter:function(a,b){this.updates[a]||(this.updates[a]=[]),this.updates[a].push(b)},onSumbit:function(){this.updates.date&&this.updates.date.each(function(a){a.onSubmit()})}});var FbListUpdateCol=my.Class(FbListPlugin,{constructor:function(a){this.parent(a),this.options.userSelect&&(Fabrik["filter_update_col"+this.options.ref+"_"+this.options.renderOrder]=new UpdateColSelect,this.makeUpdateColWindow())},buttonAction:function(){this.options.userSelect?this.win.open():this.list.submit("list.doPlugin")},makeUpdateColWindow:function(){var a,b,c,d=this;this.windowopts={id:"update_col_win_"+this.options.ref+"_"+this.options.renderOrder,title:Joomla.JText._("PLG_LIST_UPDATE_COL_UPDATE"),loadMethod:"html",content:this.options.form,width:400,destroy:!1,height:300,onOpen:function(){this.fitToContent(!1)},onContentLoaded:function(e){var f=$("#update_col"+this.options.ref+"_"+this.options.renderOrder);f.on("click","a.add",function(c,d){c.preventDefault();var e,g=d.closest("thead");e=g?f.find("tbody tr").getLast():d.closest("tr"),"none"===e.css("display")?(a=e.find("td"),a[0].find("select").selectedIndex=0,a[1].empty(),e.show()):(b=e.clone(),a=b.find("td"),a[0].find("select").selectedIndex=0,a[1].empty(),b.inject(e,"after"))}),f.on("click","a.delete",function(a,b){a.preventDefault();var c=f.find("tbody tr");1===c.length?c.getLast().hide():b.closest("tr").destroy()}),f.on("change","select.key",function(a,b){var f=$(this).closest("tbody").find(".update_col_elements");for(c=0;c<f.length;c++)if(f[c]!==b&&f[c].selectedIndex===b.selectedIndex)return void window.alert("This element has already been selected!");var g=b.options[b.selectedIndex],h=b.closest("tr");Fabrik.loader.start(h);var i=h.find("td.update_col_value"),j=$(this).val(),k=g.get("data-plugin"),l=g.get("data-id"),m=0,n="index.php?option=com_fabrik&task=list.elementFilter&format=raw";$.ajax({url:n,update:i,data:{element:j,id:d.options.listid,elid:l,plugin:k,counter:m,listref:d.options.ref,context:"visualization",parentView:"update_col"+d.options.ref+"_"+d.options.renderOrder,fabrikIngoreDefaultFilterVal:1}}).done(function(){Fabrik.loader.stop(h),e.fitToContent(!1)})}),f.find("input[type=button]").on("click",function(a){a.stop();var b;Fabrik["filter_update_col"+d.options.ref+"_"+d.options.renderOrder].onSumbit();var c=$("#listform_"+d.options.ref);b=$(document.createElement("input")).attr({type:"hidden",value:f.toQueryString(),name:"fabrik_update_col"}),b.inject(c,"bottom"),this.list.submit("list.doPlugin")})}},this.win=Fabrik.getWindow(this.windowopts),this.win.close()}});