/*! Fabrik */
FabRecordSet=my.Class({constructor:function(a,b){this.form=a,this.options={liveSite:""},$.extend(this.options,b);var c=this.form.getForm(),d=this.form.id;this.pkfield=c.find("input[name=rowid]"),this.view=this.form.options.editable===!0?"form":"details",this.url=this.options.liveSite+"index.php?option=com_fabrik&format=raw&view=plugin&g=form&task=pluginAjax&plugin=paginate&method=xRecord&formid="+d+"&mode="+this.options.view+"&rowid=",this.watchButtons()},doUpdate:function(a){var b,c=JSON.decode(a),d="form"===this.view?c.data:c.html;this.options.ids=c.ids,this.form.formElements.each(function(a,e){if("_ro"!==e.substr(-3)){b=d[e];try{a.update("null"!==typeOf(b)?a.updateUsingRaw()?c.data[e]:"form"===this.view?b:Encoder.htmlDecode(b):"")}catch(f){console.log(a,b,f)}}}.bind(this)),"form"===this.view&&(this.pkfield.value=d[this.options.pkey]),this.form.options.rowid=c.data[this.options.pkey],this.reScan(),$(window).trigger("fabrik.form.refresh",[c.post.rowid]),Fabrik.loader.stop(this.form.getBlock())},reScan:function(){var a,b;"undefined"!=typeof Slimbox&&Slimbox.scanPage(),"undefined"!=typeof Lightbox&&Lightbox.init(),"undefined"!=typeof Mediabox&&Mediabox.scanPage(),a=this.form.getForm(),a.getElements("*[data-paginate]").each(function(a){switch(b=a.get("data-paginate")){case"first":case"prev":0===this.options.ids.index?a.addClass("active"):a.removeClass("active");break;case"next":case"last":this.options.ids.index===this.options.ids.lastKey?a.addClass("active"):a.removeClass("active")}}.bind(this))},doNav:function(a){var b,c=a.get("data-paginate"),d=this,e=!0;switch(c){case"first":0===this.options.ids.index&&(e=!1),b=this.options.ids.first;break;case"last":this.options.ids.index===this.options.ids.lastKey&&(e=!1),b=this.options.ids.last;break;case"prev":0===this.options.ids.index&&(e=!1),b=this.options.ids.prev;break;case"next":this.options.ids.index===this.options.ids.lastKey&&(e=!1),b=this.options.ids.next}e&&(Fabrik.loader.start(this.form.getBlock()),$.ajax({url:this.url+b,evalScripts:!0}).done(function(a){d.doUpdate(a)}))},watchButtons:function(){var a=this.form.getForm(),b=this;a.on("click","*[data-paginate]",function(a,c){a.preventDefault(),b.doNav(c)})}});