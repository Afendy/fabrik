/*! Fabrik */
var FbThumbsList=my.Class({options:{imageover:"",imageout:"",userid:"",formid:0,noAccessMsg:"",canUse:!0},constructor:function(a,b){this.options=$.append(this.options,b),this.col=document.find("."+a),"comment"===this.options.voteType?this.setUpBootstrappedComments():this.setUpBootstrapped()},setUpBootstrappedComments:function(){var a=this;$(document).on("click","*[data-fabrik-thumb]",function(b){if(a.options.canUse){var c=$(this).hasClass("btn-success")?!1:!0,d=$(this).data("fabrik-thumb"),e=$(this).data("fabrik-thumb-formid"),f=$(this).data("fabrik-thumb-rowid");if(a.doAjax(this,d,c),"up"===d)if(c){$(this).addClass("btn-success");var g=$("button[data-fabrik-thumb-formid="+e+"][data-fabrik-thumb-rowid="+f+"][data-fabrik-thumb=down]");g.removeClass("btn-danger")}else $(this).removeClass("btn-success");else{var h=$("button[data-fabrik-thumb-formid="+e+"][data-fabrik-thumb-rowid="+f+"][data-fabrik-thumb=up]");c?($(this).addClass("btn-danger"),h.removeClass("btn-success")):$(this).removeClass("btn-danger")}}else b.stop(),a.doNoAccess()})},setUpBootstrapped:function(){var a,b,c,d=this;this.col.each(function(e){var f=e.closest(".fabrik_row");f.length>0&&(a=e.find("button.thumb-up"),b=e.find("button.thumb-down"),a.on("click",function(e){e.stop(),d.options.canUse?(c=a.hasClass("btn-success")?!1:!0,d.doAjax(a,"up",c),c?(a.addClass("btn-success"),b.removeClass("btn-danger")):a.removeClass("btn-success")):d.doNoAccess()}),b.on("click",function(e){e.stop(),d.options.canUse?(c=b.hasClass("btn-danger")?!1:!0,d.doAjax(b,"down",c),c?(b.addClass("btn-danger"),a.removeClass("btn-success")):b.removeClass("btn-danger")):d.doNoAccess()}))})},doAjax:function(a,b,c){if(this.options.canUse){c=c?!0:!1;{var d=a.parent(),e=a.get("data-fabrik-thumb-rowid");$("#count_thumb"+b+e)}Fabrik.loader.start(d),this.thumb=b;var f={option:"com_fabrik",format:"raw",task:"plugin.pluginAjax",plugin:"thumbs",method:"ajax_rate",g:"element",element_id:this.options.elid,row_id:e,elementname:this.options.elid,userid:this.options.userid,thumb:this.thumb,listid:this.options.listid,formid:this.options.formid,add:c};"comment"===this.options.voteType&&(f.special="comments_"+this.options.formid),$.ajax({url:"",data:f}).done(function(a){$("#count_thumbup"+e),$("#count_thumbdown"+e),d.find(".thumbup"),d.find(".thumbdown");Fabrik.loader.stop(d),a=JSON.decode(a),a.error?console.log(a.error):(d.find("button.thumb-up .thumb-count").text(a[0]),d.find("button.thumb-down .thumb-count").text(a[1]))})}else this.doNoAccess()},doNoAccess:function(){""!==this.options.noAccessMsg&&window.alert(this.options.noAccessMsg)}});