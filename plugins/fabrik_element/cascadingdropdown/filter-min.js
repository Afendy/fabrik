/*! Fabrik */
var CascadeFilter=my.Class({constructor:function(a,b){var c,d=this;this.options=b,this.observer=$("#"+a),this.observer?($(document.createElement("img")).attr({id:this.options.filterid+"_loading",src:Fabrik.liveSite+"media/com_fabrik/images/ajax-loader.gif",alt:"loading..."}).css({opacity:"0"}).inject(this.observer,"before"),c=this.observer.val(),this.ajaxData={option:"com_fabrik",format:"raw",task:"plugin.pluginAjax",plugin:"cascadingdropdown",method:"ajax_getOptions",element_id:this.options.elid,v:c,formid:this.options.formid,fabrik_cascade_ajax_update:1,filterview:"table"},this.observer.on("change",function(){d.periodcount=0,$("#"+d.options.filterid+"_loading").css("opacity","1"),d.update()}),this.periodical=setInterval(function(){this.update.call(this,[cb])},500),this.periodcount=0):fconsole("observer not found ",a)},update:function(){var self=this,filterData=eval(this.options.filterobj).getFilterData();this.observer&&(Object.append(this.ajaxData,filterData,{v:this.observer.val()}),this.myAjax=$.ajax({url:"",method:"post",data:this.ajaxData}).done(function(a){self.ajaxComplete(a)}))},ajaxComplete:function(a){var b=this;return a=JSON.decode(a),this.periodcount++,this.periodcount>5?void this.endAjax():0===$("#"+this.options.filterid).length?(fconsole("filterid not found: ",this.options.filterid),void this.endAjax()):($("#"+this.options.filterid).empty(),a.each(function(a){$(document.createElement("option")).attr({value:a.value}).text(a.text).inject($("#"+b.options.filterid)),$("#"+b.options.filterid).val(b.options.def)}),void(a.length>0?(1===a.length&&""===a[0].value)==!1&&this.endAjax():this.endAjax()))},endAjax:function(){$("#"+this.options.filterid+"_loading").css("opacity","0"),clearInterval(this.periodical)}});