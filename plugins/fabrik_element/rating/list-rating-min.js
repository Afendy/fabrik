/*! Fabrik */
var FbRatingList=my.Class({options:{userid:0,mode:"",formid:0},constructor:function(a,b){var c=this;b.element=a,this.setOptions(b),this.options=$.extend(this.options,b),this.options.canRate!==!1&&"creator-rating"!==this.options.mode&&(this.col=$("."+a),this.origRating={},this.col.each(function(a){var b=a.getElements(".starRating");b.each(function(d){d.on("mouseover",function(){c.origRating[a.id]=parseInt(d.closest(".fabrik_element").find(".ratingMessage").html(),10),b.each(function(a){c._getRating(d)>=c._getRating(a)?a.removeClass("icon-star-empty").addClass("icon-star"):a.addClass("icon-star-empty").removeClass("icon-star")}),d.closest(".fabrik_element").find(".ratingMessage").html(d.data("fabrik-rating"))}),d.on("mouseout",function(){b.each(function(b){c.origRating[a.id]>=c._getRating(b)?b.removeClass("icon-star-empty").addClass("icon-star"):b.addClass("icon-star-empty").removeClass("icon-star")}),d.closest(".fabrik_element").find(".ratingMessage").html(this.origRating[a.id])})}),b.each(function(a){a.on("click",function(b){c.doAjax(b,a)})})}))},_getRating:function(a){var b=a.data("fabrik-rating");return b.toInt()},doAjax:function(a,b){var c=this;a.stopPropagation(),this.rating=this._getRating(b);var d=b.closest(".fabrik_element").find(".ratingMessage");Fabrik.loader.start(d);var e=$(document.createElement("div")).attr({id:"starRatingCover"}).css({bottom:0,top:0,right:0,left:0,position:"absolute",cursor:"progress"}),f=b.closest(".fabrik_element").find("div");f.grab(e,"top");var g=$("#"+b).closest(".fabrik_row"),h=g.id.replace("list_"+this.options.listRef+"_row_",""),i={option:"com_fabrik",format:"raw",task:"plugin.pluginAjax",plugin:"rating",g:"element",method:"ajax_rate",formid:this.options.formid,element_id:this.options.elid,row_id:h,elementname:this.options.elid,userid:this.options.userid,rating:this.rating,mode:this.options.mode};new $.ajax({url:"",data:i}).done(function(a){a=a.toInt(),c.rating=a,d.html(this.rating),Fabrik.loader.stop(d),b.closest(".fabrik_element").find("i").each(function(b,c){a>c?$(this).removeClass("icon-star-empty").addClass("icon-star"):$(this).addClass("icon-star-empty").removeClass("icon-star")}),$("#starRatingCover").destroy()})}});