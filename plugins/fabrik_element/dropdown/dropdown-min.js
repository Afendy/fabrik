/*! Fabrik */
var FbDropdown=my.Class(FbElement,{constructor:function(a,b){this.plugin="fabrikdropdown",FbDropdown.Super.call(this,a,b),this.options.allowadd===!0&&this.options.editable!==!1&&(this.watchAddToggle(),this.watchAdd())},watchAddToggle:function(){var a,b,c,d=this.getContainer(),e=d.find("div.addoption"),f=d.find(".toggle-addoption"),g=this.element.prop("id");this.mySlider&&(a=e.clone(),b=d.find(".fabrikElement"),e.parent().destroy(),b.append(a),e=d.find("div.addoption"),e.css("margin",0),c=e.find("input[name*=_additions]"),c.id=g+"_additions",c.name=g+"_additions"),$(e).slideUp(500),f.on("click",function(a){a.stopPropagation(),$(e).slideToggle()})},addClick:function(a){var b,c=this.getContainer(),d=c.find("input[name=addPicklistLabel]"),e=c.find("input[name=addPicklistValue]"),f=d.val();b=e.length>0?e.val():f,""===b||""===f?window.alert(Joomla.JText._("PLG_ELEMENT_DROPDOWN_ENTER_VALUE_LABEL")):($(document.createElement("option")).attr({selected:"selected",value:b}).text(f).prependTo(this.element),a.stopPropagation(),e&&(e.value=""),d.value="",this.addNewOption(b,f),this.element.trigger("change",{stop:function(){}}),this.mySlider&&this.mySlider.toggle(),this.options.advanced&&this.element.trigger("liszt:updated"))},watchAdd:function(){if(this.options.allowadd===!0&&this.options.editable!==!1){var a=this.getContainer();this.addClickEvent&&a.find("input[type=button]").removeEvent("click",this.addClickEvent),this.addClickEvent=this.addClick.bind(this),a.find("input[type=button]").on("click",this.addClickEvent)}},getValue:function(){if(!this.options.editable)return this.options.value;if(null===this.element.val())return"";if(this.options.multiple){var a=[];return this.element.find("option").each(function(b){b.selected&&a.push(b.value)}),a}return this.element.val()},reset:function(){var a=this.options.defaultVal;this.update(a)},update:function(a){var b=[],c=this;if("string"==typeof a&&JSON.validate(a)&&(a=JSON.decode(a)),void 0===a&&(a=[]),this.find(),this.options.element=this.element.id,!this.options.editable)return this.element.html(""),void jQuery.each(a,function(){c.element.html(c.element.html()+c.options.data[this]+"<br />")});b=this.element.find("option"),"number"==typeof a&&(a=a.toString());for(var d=0;d<b.length;d++)b[d].selected=-1!==a.indexOf(b[d].value)?!0:!1;this.watchAdd()},cloned:function(a){this.options.allowadd===!0&&this.options.editable!==!1&&(this.watchAddToggle(),this.watchAdd()),FbDropdown.Super.prototype.cloned(this,a)}});