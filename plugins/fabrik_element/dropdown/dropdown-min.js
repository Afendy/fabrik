/*! Fabrik */
var FbDropdown=my.Class(FbElement,{constructor:function(a,b){this.plugin="fabrikdropdown",this.parent(a,b),this.options.allowadd===!0&&this.options.editable!==!1&&(this.watchAddToggle(),this.watchAdd())},watchAddToggle:function(){var a,b,c,d=this,e=this.getContainer(),f=e.find("div.addoption"),g=e.find(".toggle-addoption");this.mySlider&&(a=f.clone(),b=e.find(".fabrikElement"),f.parent().destroy(),b.adopt(a),f=e.find("div.addoption"),f.css("margin",0),c=f.find("input[name*=_additions]"),c.id=this.element.id+"_additions",c.name=this.element.id+"_additions"),this.mySlider=new Fx.Slide(f,{duration:500}),this.mySlider.hide(),g.on("click",function(a){a.stop(),d.mySlider.toggle()})},addClick:function(a){var b,c=this.getContainer(),d=c.find("input[name=addPicklistLabel]"),e=c.find("input[name=addPicklistValue]"),f=d.value;if(b=e?e.value:f,""===b||""===f)window.alert(Joomla.JText._("PLG_ELEMENT_DROPDOWN_ENTER_VALUE_LABEL"));else{{$(document.createElement("option")).attr({selected:"selected",value:b}).text(f).inject($("#"+this.element.id))}a.stop(),e&&(e.value=""),d.value="",this.addNewOption(b,f),$("#"+this.element.id).trigger("change",{stop:function(){}}),this.mySlider&&this.mySlider.toggle(),this.options.advanced&&$("#"+this.element.id).trigger("liszt:updated")}},watchAdd:function(){if(this.options.allowadd===!0&&this.options.editable!==!1){var a=this.getContainer();this.addClickEvent&&a.find("input[type=button]").removeEvent("click",this.addClickEvent),this.addClickEvent=this.addClick.bind(this),a.find("input[type=button]").on("click",this.addClickEvent)}},getValue:function(){if(!this.options.editable)return this.options.value;if("null"===typeOf(this.element.get("value")))return"";if(this.options.multiple){var a=[];return this.element.getElements("option").each(function(b){b.selected&&a.push(b.value)}),a}return this.element.get("value")},reset:function(){var a=this.options.defaultVal;this.update(a)},update:function(a){var b=[],c=this;if("string"==typeof a&&JSON.validate(a)&&(a=JSON.decode(a)),void 0===a&&(a=[]),this.find(),this.options.element=this.element.id,!this.options.editable)return this.element.html(""),void jQuery.each(a,function(){c.element.html(c.element.html()+c.options.data[this]+"<br />")});b=this.element.getElements("option"),"number"==typeof a&&(a=a.toString());for(var d=0;d<b.length;d++)b[d].selected=-1!==a.indexOf(b[d].value)?!0:!1;this.watchAdd()},cloned:function(a){this.options.allowadd===!0&&this.options.editable!==!1&&(this.watchAddToggle(),this.watchAdd()),this.parent(a)}});