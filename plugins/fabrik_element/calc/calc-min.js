/*! Fabrik */
var FbCalc=my.Class(FbElement,{constructor:function(a,b){this.plugin="calc",this.oldAjaxCalc=null,FbCalc.Super.call(this,a,b)},attachedToForm:function(){if(this.options.ajax){{var a;this.form}this.options.observe.each(function(b){""!==b&&(this.form.formElements[b]?this.form.formElements[b].addNewEventAux(this.form.formElements[b].getChangeEvent(),function(a){this.calc(a)}.bind(this)):this.options.canRepeat?(a=b+"_"+this.options.repeatCounter,this.form.formElements[a]&&this.form.formElements[a].addNewEventAux(this.form.formElements[a].getChangeEvent(),function(a){this.calc(a)}.bind(this))):this.form.repeatGroupMarkers.each(function(c,d){for(a="",v2=0;v2<c;v2++)a="join___"+this.form.options.group_join_ids[d]+"___"+b+"_"+v2,this.form.formElements[a]&&this.form.formElements[a].addNewEvent(this.form.formElements[a].getChangeEvent(),function(a){this.calc(a)}.bind(this))}.bind(this)))}.bind(this)),this.options.calcOnLoad&&this.calc()}},calc:function(){var a=this.form.getFormElementData(),b=this.form.getFormData(!1),c=this;$.each(b,function(b,c){(b.test(/^join\[\d+\]/)||b.test(/^fabrik_vars/))&&(a[b]=c)}),$.each(a,function(b,d){var e=c.form.formElements.get(b);e&&e.options.inRepeatGroup&&e.options.joinid===c.options.joinid&&e.options.repeatCounter===c.options.repeatCounter&&(a[e.options.fullName]=d,a[e.options.fullName+"_raw"]=a[b+"_raw"])});var d={option:"com_fabrik",format:"raw",task:"plugin.pluginAjax",plugin:"calc",method:"ajax_calc",element_id:this.options.id,formid:this.form.id};d=Object.append(a,d),Fabrik.loader.start(this.element.parent(),Joomla.JText._("COM_FABRIK_VALIDATING")),$.ajax({url:"",method:"post",data:d}).done(function(a){Fabrik.loader.stop(c.element.parent()),c.update(a),c.options.validations&&c.form.doElementValidation(c.options.element),c.element.trigger("change"),Fabrik.trigger("fabrik.calc.update",[this,a])})},cloned:function(a){FbCalc.Super.prototype.cloned(this,a),this.attachedToForm()},update:function(a){this.getElement()&&(this.element.innerHTML=a,this.options.value=a)},getValue:function(){return this.element?this.options.value:!1}});