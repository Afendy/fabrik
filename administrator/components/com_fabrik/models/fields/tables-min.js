/*! Fabrik */
var tablesElement=my.Class({options:{conn:null},constructor:function(a,b){this.el=a,this.options=$.append(this.options,b),0===$("#"+this.options.conn).length?this.periodical=setInterval(function(){this.getCnn.call(this,!0)},500):this.setUp()},cloned:function(){},getCnn:function(){0!==$("#"+this.options.conn).length&&(this.setUp(),clearInterval(this.periodical))},setUp:function(){var a=this;this.el=$("#"+this.el),this.cnn=$("#"+this.options.conn),this.loader=$("#"+this.el.id+"_loader"),this.cnn.on("change",function(){a.updateMe()});var b=this.cnn.get("value");""!==b&&-1!==b&&this.updateMe()},updateMe:function(a){var b=this;a&&a.stop(),this.loader&&this.loader.show();var c=this.cnn.val(),d=$.getJSON({url:"index.php",data:{option:"com_fabrik",format:"raw",task:"plugin.pluginAjax",g:"element",plugin:"field",method:"ajax_tables",cid:parseInt(c,10)}}).done(function(a){a.err?window.alert(a.err):(b.el.empty(),a.each(function(a){var c={value:a};a===b.options.value&&(c.selected="selected"),b.loader&&b.loader.hide(),$(document.createElement("option")).attr(c).text(a).inject(this.el)}))}).fail(function(a,c,d){b.el.empty(),b.loader&&b.loader.hide(),window.alert(c+": "+d)});Fabrik.requestQueue.add(d)}});