/*! Fabrik */
var Suboptions=my.Class({options:{sub_initial_selection:[],j3:!1,defaultMax:0},constructor:function(a,b){this.options=$.extend(this.options,b),this.element=$("#"+this.options.id),0===this.element.length&&window.confirm("oh dear - somethings gone wrong with loading the sub-options, do you want to reload?")&&location.reload(!0),this.watchButtons(),this.watchDefaultCheckboxes(),this.counter=0,this.name=a,Object.each(this.options.sub_values,function(a,b){var c=Object.contains(this.options.sub_initial_selection,a)?"checked='checked'":"";this.addSubElement(a,this.options.sub_labels[b],c)}.bind(this)),0===this.options.sub_values.length&&this.addSubElement("","",!1),Joomla.submitbutton=function(a){return"element.cancel"===a||this.onSave()?void Joomla.submitform(a):!1}.bind(this)},watchDefaultCheckboxes:function(){var a=this;this.element.on("click","input.sub_initial_selection",function(b){1===a.options.defaultMax&&this.element.find("input.sub_initial_selection").each(function(){this!==b.target&&$(this).prop("checked",!1)})})},watchButtons:function(){var a=this;this.element.on("click",'a[data-button="addSuboption"]',function(b){b.preventDefault(),a.addSubElement()}),this.element.on("click",'a[data-button="deleteSuboption"]',function(b){b.preventDefault();var c=a.element.find("tbody tr");c.length>1&&$(this).closest("tr").remove()})},addOption:function(a){this.addSubElement(),a.stopPropagation()},removeSubElement:function(a){var b=a.target.id.replace("sub_delete_","");$("#sub_subElementBody").find("li").length>1&&$("#sub_content_"+b).remove(),a.stopPropagation()},addJ3SubElement:function(a,b,c){var d=this._chx(a,c),e=this._deleteButton(),f=$(document.createElement("tr")).append([$(document.createElement("td")).addClass("handle subhandle"),$(document.createElement("td")).attr({width:"30%"}).append(this._valueField(a)),$(document.createElement("td")).attr({width:"30%"}).append(this._labelField(b)),$(document.createElement("td")).attr({width:"10%"}).html(d),e]),g=this.element.find("tbody");g.adopt(f),this.sortable?this.sortable.addItems(f):this.sortable=new Sortables(g,{handle:".subhandle"}),this.counter++},_valueField:function(a){return $(document.createElement("input")).addClass("inputbox sub_values").attr({type:"text",name:this.name+"[sub_values][]",id:"sub_value_"+this.counter,size:20,value:a})},_labelField:function(a){return $(document.createElement("input")).addClass("inputbox sub_labels").attr({type:"text",name:this.name+"[sub_labels][]",id:"sub_text_"+this.counter,size:20,value:a})},_chx:function(a,b){return'<input class="inputbox sub_initial_selection" type="checkbox" value="'+a+"\" name='"+this.name+"[sub_initial_selection][]' id=\"sub_checked_"+this.counter+'" '+b+" />"},_deleteButton:function(){return $(document.createElement("td")).attr({width:"20%"}).html(this.options.delButton)},addSubElement:function(a,b,c){return this.addJ3SubElement(a,b,c)},onSave:function(){var a=[],b=!0,c=$("#jform_params_dropdown_populate"),d=!1;return""!==c.val()&&(d=!0),d||$(".sub_values").each(function(){""===$(this).val()&&(window.alert(Joomla.JText._("COM_FABRIK_SUBOPTS_VALUES_ERROR")),b=!1),a.push($(this).val())}),$(".sub_initial_selection").each(function(b){$(this).val(a[b])}),b}});