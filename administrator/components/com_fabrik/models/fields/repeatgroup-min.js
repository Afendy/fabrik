/*! Fabrik */
var FbRepeatGroup=my.Class({options:{repeatmin:1},constructor:function(a,b){this.element=document.id(a),this.options=$.append(this.options,b),this.counter=this.getCounter(),this.watchAdd(),this.watchDelete()},repeatContainers:function(){return this.element.getElements(".repeatGroup")},watchAdd:function(){this.element.getElement("a[data-button=addButton]").addEvent("click",function(a){a.stop();var b=this.repeatContainers().getLast(),c=this.counter+1,d=b.id.replace("-"+this.counter,"-"+c),e=new Element("div",{"class":"repeatGroup",id:d}).set("html",b.innerHTML);e.inject(b,"after"),this.counter=c,0!==this.counter&&(jQuery.each(e.getElements("input, select"),function(a,b){var c="",d=b.id;if(""!==b.id){var e=b.id.split("-");e.pop(),c=e.join("-")+"-"+this.counter,b.id=c}this.increaseName(b),jQuery.each(FabrikAdmin.model.fields,function(a){var e=!1;if("null"!==typeOf(FabrikAdmin.model.fields[a][d])){var f=FabrikAdmin.model.fields[a][d];e=Object.clone(f);try{e.cloned(c,this.counter)}catch(g){fconsole("no clone method available for "+b.id)}}e!==!1&&(FabrikAdmin.model.fields[a][b.id]=e)}.bind(this))}.bind(this)),jQuery.each(e.getElements("img[src=components/com_fabrik/images/ajax-loader.gif]"),function(a,b){var c=b.id.split("-");c.pop();var d=c.join("-")+"-"+this.counter+"_loader";b.id=d}.bind(this)))}.bind(this))},getCounter:function(){return this.repeatContainers().length},watchDelete:function(){var a=this.element.getElements("a[data-button=deleteButton]");a.removeEvents(),jQuery.each(a,function(a,b){b.addEvent("click",function(b){b.stop();var c=this.getCounter();if(c>this.options.repeatmin){var d=this.repeatContainers().getLast();d.destroy()}this.rename(a)}.bind(this))}.bind(this))},increaseName:function(a){var b=a.name.split("]["),c=b[2].replace("]","").toInt()+1;b.splice(2,1,c),a.name=b.join("][")+"]"},rename:function(a){jQuery.each(this.element.getElements("input, select"),function(b,c){c.name=this._decreaseName(c.name,a)}.bind(this))},_decreaseName:function(a,b){var c=a.split("]["),d=c[2].replace("]","").toInt();d>=1&&d>b&&d--,3===c.length&&(d+="]"),c.splice(2,1,d);var e=c.join("][");return e}});