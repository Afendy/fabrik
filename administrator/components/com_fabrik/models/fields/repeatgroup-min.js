/*! Fabrik */
var FbRepeatGroup=my.Class({options:{repeatmin:1},constructor:function(a,b){this.element=$("#"+a),this.options=$.extend(this.options,b),this.counter=this.getCounter(),this.watchAdd(),this.watchDelete()},repeatContainers:function(){return this.element.find(".repeatGroup")},watchAdd:function(){var a=this;this.element.find("a[data-button=addButton]").on("click",function(b){b.stopPropagation();var c=a.repeatContainers().getLast(),d=a.counter+1,e=c.id.replace("-"+a.counter,"-"+d),f=$(document.createElement("div")).addClass("repeatGroup").attr({id:e}).html(c.innerHTML);f.inject(c,"after"),a.counter=d,0!==a.counter&&(f.find("input, select").each(function(b,c){var d="",e=c.id;if(""!==c.id){var f=c.id.split("-");f.pop(),d=f.join("-")+"-"+a.counter,c.id=d}a.increaseName(c),jQuery.each(FabrikAdmin.model.fields,function(b){var f=!1;if(void 0!==FabrikAdmin.model.fields[b][e]){var g=FabrikAdmin.model.fields[b][e];f=Object.clone(g);try{f.cloned(d,a.counter)}catch(h){fconsole("no clone method available for "+c.id)}}f!==!1&&(FabrikAdmin.model.fields[b][c.id]=f)})}),f.find("img[src=components/com_fabrik/images/ajax-loader.gif]").each(function(){var b=this.id.split("-");b.pop();var c=b.join("-")+"-"+a.counter+"_loader";this.id=c}))})},getCounter:function(){return this.repeatContainers().length},watchDelete:function(){var a=this.element.find("a[data-button=deleteButton]"),b=this;a.off(),a.each(function(a){$(this).on("click",function(c){c.stopPropagation();var d=b.getCounter();if(d>b.options.repeatmin){var e=b.repeatContainers().getLast();e.destroy()}b.rename(a)})})},increaseName:function(a){var b=a.name.split("]["),c=parseInt(b[2].replace("]",""),10)+1;b.splice(2,1,c),a.name=b.join("][")+"]"},rename:function(a){var b=this;this.element.find("input, select").each(function(){this.name=b._decreaseName(this.name,a)})},_decreaseName:function(a,b){var c=a.split("]["),d=parseInt(c[2].replace("]",""),10);d>=1&&d>b&&d--,3===c.length&&(d+="]"),c.splice(2,1,d);var e=c.join("][");return e}});